#ã€€1. GraphQLä»‹ç»               

[`GraphQL`](http://graphql.org/) ç”Ÿæ¥æ˜¯è¦å–ä»£ REST çš„ï¼Œå®ƒæ˜¯ä¸€ç§å…¨æ–°çš„ API æ ‡å‡†(éšç€è½¯ä»¶è¡Œä¸šçš„ä¸æ–­å‘å±• API å·²ç»æ— å¤„ä¸åœ¨ ç®€è€Œè¨€ä¹‹ API å®šä¹‰äº†(è¯´çš„æ˜¯)å®¢æˆ·ç«¯ä»æœåŠ¡å™¨åŠ è½½/è¯»å–æ•°æ®çš„æ–¹å¼)

ç°å¦‚ä»Šå¤§å¤šæ•°ç³»ç»Ÿæˆ–è€…è½¯ä»¶éƒ½éœ€è¦ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Œé‚£å°æœåŠ¡å™¨ä¸Šæœ‰ä¸ªæ•°æ®åº“ï¼Œæ•°æ®å…¨å­˜åœ¨æ•°æ®åº“é‡Œé¢ã€‚
API å°±æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“é‡Œçš„æ•°æ®å’Œåº”ç”¨ç¨‹åºéœ€æ±‚ä¹‹é—´çš„é‚£åº§æ¡¥æ¢ã€‚

å¾ˆå¤šäººéƒ½ä¼šè¯¯ä»¥ä¸º `GraphQL` æ˜¯ä¸€ç§æ•°æ®åº“æŠ€æœ¯ï¼Œè¿™æ˜¯ä¸å‡†ç¡®çš„ï¼Œäº‹å®ä¸Šï¼Œå®ƒæ˜¯ä¸“é—¨é’ˆå¯¹ API çš„ä¸€ç§æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´å’Œæ•°æ®åº“æ˜¯æ— å…³çš„ï¼Œä¸”å¯ä»¥åº”ç”¨åœ¨ä»»ä½•ä¼šè¦åˆ° API çš„åœºæ™¯ä¸­ã€‚

>å®˜æ–¹å®šä¹‰ï¼šæ¥è‡ª `facebook` çš„ **API æŸ¥è¯¢è¯­è¨€**ã€‚é€šè¿‡ä½¿ç”¨`GraphQL`ï¼Œä½ å¯ä»¥åŸºäº [å›¾](https://goo.gl/9JgOxd) æ¨¡å¼å®šä¹‰ä½ çš„åç«¯ã€‚éšåï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥æ ¹æ®éœ€æ±‚æŸ¥è¯¢ä½ çš„æ•°æ®é›†äº†ã€‚

`GraphQL` çš„æ ¸å¿ƒåœ¨äºå®ç°äº†å£°æ˜å¼çš„æ•°æ®è·å–(éœ€è¦å•¥ç»™å•¥ åˆ«ä¸€è‚¡è„‘ç»™ä¸€å¤§æ¨æˆ‘è¿˜å¾—æŒ‘)ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ API è§„å®šé‚£äº›å®ƒçœŸæ­£éœ€è¦çš„æ•°æ®ã€‚åŸæ¥å¯èƒ½è¦å¥½å‡ ä¸ªæ¥å£æ‰èƒ½æ‹¼æˆä¸€ä¸ªä½ æƒ³è¦çš„æ•°æ®ç»“æ„ï¼Œç°åœ¨åªéœ€è¦ä¸€ä¸ªurlå³å¯è·å–å®¢æˆ·ç«¯éœ€è¦çš„å†…å®¹ã€‚
>å…¶ä»–è¡¨è¿°ï¼šä¸åŒäº SOAP æˆ–è€… REST æ¥å£ï¼ŒGraphQL æœ€å¤§çš„å¥½å¤„åœ¨äºä½ å¯ä»¥æ— é™çµæ´»åœ°åœ¨æ¥å£è¯·æ±‚ä¸­æŒ‰ç…§ä½ æƒ³è¦çš„æ–¹å¼æŒ‰éœ€è·å–ä½ æƒ³è¦çš„æ•°æ®ã€‚æ¥å£æä¾›æ–¹æ— éœ€é‡æ–°åˆ›å»ºæ–°çš„æ¥å£ï¼Œä¸€ä¸ªæ¥å£å°±å¯ä»¥å½“åšå¤šä¸ªæ¥å£æ¥ä½¿ç”¨ã€‚

å¸¸è§„æ¥å£èƒœåœ¨å®šä¹‰å¾ˆå®Œå–„ï¼Œä¸”æ˜¯ä¸ºäº†ç‰¹å®šçš„åœºæ™¯é’ˆå¯¹æ€§çš„å®šä¹‰çš„ã€‚æ¥å£ä¸€èˆ¬éƒ½æœ‰è®¾å®šå¥½çš„è¯·æ±‚å’Œå“åº”ä¸ªæ•°ï¼Œè€Œä¸ç®¡æ˜¯å¦æ»¡è¶³ä½ ä½¿ç”¨çš„æ–¹å¼ã€‚è€Œ *GraphQL* åˆ™å¯ä»¥è®©ä½ æŒæ§è¿™ä¸€åˆ‡ï¼Œä½ å¯ä»¥éšå¿ƒæ‰€æ¬²çš„æŒ‰ç…§ä½ æƒ³è¦çš„æ–¹å¼æ¥è¯·æ±‚å’Œä½¿ç”¨æ•°æ®ã€‚

è¿™æ—¢æ˜¯ä¼˜ç‚¹ï¼Œä¹Ÿæ˜¯ç¼ºç‚¹ã€‚å¦‚æœä½ çš„åº”ç”¨åœºæ™¯ä¸‹ä¸éœ€è¦æ‰€æœ‰çš„æ•°æ®ï¼Œ GraphQL èƒ½å¤Ÿæå‡æ•°æ®è¯·æ±‚é€Ÿåº¦ï¼Œå› ä¸ºæœåŠ¡ç«¯çš„å·¥ä½œé‡æ›´å°‘äº†ã€‚ç›¸åï¼Œå¦‚æœä½ åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­éœ€è¦æ‰€æœ‰çš„æ•°æ®ï¼Œæ•°æ®è¯·æ±‚é€Ÿåº¦ä¼šç”±äºå·¥ä½œé‡å¢åŠ è€Œé™ä½ã€‚

åœ¨ Facebook è¿™æ ·çš„äº’è”ç½‘å…¬å¸ GraphQL è§£å†³äº†ä¸€ä¸ªåå°å¯¹å¤šä¸ªå®¢æˆ·ç«¯çš„æƒ…å½¢ï¼Œè§£å†³çš„æ˜¯åå°æ¥å£ä¸€æ¬¡å¼€å‘ï¼Œå¦‚ä½•åº”å¯¹å¤šç§å®¢æˆ·ç«¯ä¸åŒçš„ä¸ªæ€§åŒ–å±•ç°è¯·æ±‚ã€‚å¦‚æœæŠŠé—®é¢˜åŸŸç±»æ¯”åˆ°å¼‚æ„ç³»ç»Ÿçš„äº’è”äº’é€šä¸­ï¼ŒåŸæ¥ä¸è®ºæ˜¯é›†æˆå¹³å°ï¼ŒHISä¹Ÿå¥½ï¼Œæ‰€å·ç§°çš„å¼€å‘æ¥å£ä¸€æ¬¡ï¼Œå¤šæ¬¡ä½¿ç”¨çš„å£å·å…¶å®æ˜¯åœ¨æ‰¯æ·¡ï¼Œå³å°±æ˜¯æä¾›æ¥å£çš„ç³»ç»Ÿæ•°æ®åº“è¡¨ç»“æ„ä¿æŒä¸å˜ï¼Œå½“ä½¿ç”¨æ¥å£çš„ç³»ç»Ÿæƒ³è¦è·å–æ¯”ä¹‹å‰æ›´å¤šè¿”å›å­—æ®µæ—¶ï¼Œæ¥å£æä¾›æ–¹æ˜¯éœ€è¦äººå·¥æ”¹é€ æ¥å¾—åˆ°æ–°çš„æ¥å£ã€‚ä½†æœ‰äº† GraphQL ï¼Œä½œä¸ºä¸åŒç³»ç»Ÿé—´çš„ä»£ç†ï¼Œå¯¹æ¯”å…¶ä¸­ä¸€ä¸ªä½œä¸ºæ¥å£æä¾›æ–¹è§’è‰²çš„ç³»ç»Ÿï¼Œåªè¦ä½ æ•°æ®åº“è¡¨ç»“æ„ä¿æŒä¸å˜ï¼Œå°±å®Œå…¨å¯ä»¥åªå¼€å‘ä¸€æ¬¡æ¥å£ã€‚å¯ä»¥è¿™ä¹ˆç†è§£ åªè¦HISçš„æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡çš„è¶³å¤Ÿå®Œå–„å’Œç¨³å®š é‚£ä¹ˆåŒ»é™¢æƒ³åœ¨åŸæœ‰æ•°æ®åŸºç¡€ä¸Šè‡ªå·±å¼€å‘æ–°çš„ HIS ç³»ç»Ÿæˆ–è€…å…¶ä»–åº”ç”¨æ˜¯å®Œå…¨æœ‰å¯èƒ½çš„ã€‚

![GraphQL Overview](https://cldup.com/ysnmIMhqRU.png)

å› æ­¤ï¼Œæ‚¨ä¸å¿…å› ä¸ºå®¢æˆ·ç«¯æ•°æ®éœ€æ±‚çš„å˜æ›´è€Œå»ä¿®æ”¹ä½ çš„åç«¯ã€‚è¿™ä»æ ¹æœ¬ä¸Šè§£å†³äº†ç®¡ç†`REST API`ä¸­çš„ä¸€ä¸ªæœ€å¤§çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯HL7 ä»2011å¹´ä¸€ç›´åœ¨æå€¡çš„ FHIR æ ‡å‡†éš¾ä»¥å›é¿çš„éš¾é¢˜ã€‚
>ç”»å¤–éŸ³ï¼šREST æ›¾ç«æä¸€æ—¶ï¼Œæˆ–è®¸ç°åœ¨ä»ç„¶æ˜¯ã€‚åœ¨ REST æå‡ºä¹‹æ—¶ï¼Œç”±äºå®¢æˆ·ç«¯ç›¸å¯¹ç°åœ¨çš„è¾ƒç®€å•ï¼Œå¼€å‘å‘¨æœŸå’Œé€Ÿåº¦ä¹Ÿæ²¡æœ‰ç°å¦‚ä»Šè¿™ä¹ˆå¿«ï¼Œå®ƒè¿˜æ˜¯å¾ˆé€‚åˆé‚£ä¸ªå¹´ä»£ã€‚ä½†æœ€è¿‘è¿™å‡ å¹´ å¦‚ä¸‹è¿™ä¸‰ä¸ªåŸå› ä¸æ–­åœ¨æŒ‘æˆ˜ API è®¾è®¡çš„æ–¹å¼ï¼š
>1.è¶Šæ¥è¶Šå¤šçš„ç§»åŠ¨ç«¯åº”ç”¨è¦æ±‚æ•°æ®åŠ è½½æ›´å¿«é«˜æ•ˆ ç§»åŠ¨è®¾å¤‡ç”¨çš„è¶Šæ¥è¶Šå¤šï¼Œè€—ç”µé‡ã€ç½‘ç»œäº¤å‰çš„æƒ…å†µ ç­‰ç­‰æ˜¯ GraphQL è¯ç”Ÿçš„åˆéŸ³ã€‚å¦‚ä½•æœ€å¤§åŒ–çš„å‡å°‘ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®çš„å¤§å°ï¼Œä¸ä¼šè¿‡å¤šï¼Œä¹Ÿä¸ä¼šè¿‡å°‘ï¼Œåˆšåˆšå¥½ï¼Œæå‡åº”ç”¨çš„ç”¨æˆ·ä½“éªŒï¼Œ GrapQL æ­£æ˜¯ä¸ºæ­¤è€Œç”Ÿ
>2.å‰ç«¯å¹³å°å’Œæ¡†æ¶çš„å–·æ¶Œ å¦‚æœåªæ„å»ºå’Œç»´æŠ¤ä¸€ä¸ªAPIçš„è¯ æ²¡æ³•æ»¡è¶³é‚£äº›è¿è¡Œå®¢æˆ·ç«¯ç¨‹åºçš„å¼‚æ„å‰ç«¯å¹³å°å’Œæ¡†æ¶çš„éœ€æ±‚ã€‚è€Œæœ‰äº† GraphQL æ¯ç§å®¢æˆ·ç«¯éƒ½å¯ä»¥åªè®¿é—®è‡ªå·±éœ€è¦çš„æ•°æ®ã€‚
>3.å¿«é€Ÿå¼€å‘å’ŒåŠŸèƒ½è¿­ä»£ å¾ˆå¤šå…¬å¸ç°åœ¨éƒ½æŠŠæŒç»­éƒ¨ç½²ä½œä¸ºä¸€ä¸ªæ ‡å‡†æ¥åšã€‚REST API  å¦‚æœå®¢æˆ·ç«¯çš„è®¾è®¡å˜åŒ–æˆ–è€…æäº†ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ åç«¯å°±å¾—ç´§è·Ÿç€æ”¹ã€‚è¿™é˜»ç¢äº†äº§å“è¿­ä»£å’Œå¿«é€Ÿå¼€å‘çš„å¼€å±•ã€‚
>![æ›´å¤šä¼˜åŠ£å¯¹æ¯”è¯·å‚è€ƒ GraphQL is the better REST](https://www.howtographql.com/basics/1-graphql-is-the-better-rest/)

ä»¥æŸç§»åŠ¨åŒ»ç–—å…¬å¸å¼€å‘çš„é¢„çº¦æŒ‚å·è¯·æ±‚ä¸ºä¾‹è¿›è¡Œè¯´æ˜    

```
{
    "AppointmentId": "id",
    "AppointmentType": "é¢„çº¦æ–¹å¼ç¼–ç  ç¬¬ä¸‰æ–¹é¢„çº¦",
    "AppointmentReason": {
        "code": "é¢„çº¦åŸå› -ç–¾ç—…ç¼–ç ",
        "text": "ç–¾ç—…ç¼–ç çš„éç»“æ„åŒ–æè¿°"
    },
    "AppointmentType": "å·åˆ« ä¸“å®¶",
    "AppointmentVisitDate": "é¢„çº¦çš„å°±è¯Šæ—¥æœŸ",    
    "AppointmentVisitTime":{
        "AppointmentStart": "è¯¥å·åˆ«çš„é—¨è¯Šå¼€æ”¾æ—¶é—´å¼€å§‹æ—¶é—´",
        "AppointmentEnd": "è¯¥å·åˆ«çš„é—¨è¯Šå¼€æ”¾æ—¶é—´ç»“æŸæ—¶é—´"
    },
    "AppointmentMadeDate": "è¿›è¡Œé¢„çº¦çš„æ—¥æœŸ",   
    "AppointmentStatus": "é¢„çº¦çŠ¶æ€ pending ç­‰å¾…ç¡®è®¤ä¸­ã€booked å·²å®Œæˆé¢„çº¦ã€arrived æ‚£è€…åœ¨é¢„çº¦æ—¥æœŸæ—¶é—´å†…å‡ºç°ã€fulfilled æ‚£è€…å®Œæˆé¢„çº¦ã€cancelled é¢„çº¦è¢«å–æ¶ˆã€noshow æ‚£è€…çˆ½çº¦)",
    "AppointmentDescription": "é¢„çº¦æè¿°",
    "SlotId": "<æœ¬æ¬¡é¢„çº¦é€‰æ‹©çš„å¯é€‰æ—¶é—´æ®µçš„ç³»ç»Ÿid>",
    "PatientId": "<æ‚£è€…çš„ç³»ç»Ÿid>",
    "PatientIdentifiers": [
      {
        "cardType": "<å¡ç±»å‹>",
        "cardNo": "å¡å· æ‚£è€…çš„èº«ä»½æ ‡è¯†",
        "cardName": "å¡åç§°"
      },
      {
        "cardType": "<å¡ç±»å‹>",
        "cardNo": "å¡å· æ‚£è€…çš„èº«ä»½æ ‡è¯†",
        "cardName": "å¡åç§°"
      }      
    ]
    "PatientName": "<æ‚£è€…å§“å>",
    "PatientConfirmStatus": "æ‚£è€…æ˜¯å¦ç¡®è®¤é¢„çº¦çš„çŠ¶æ€ åˆå§‹å€¼ needs-action",
    "PractitionerId": "<åŒ»ç”Ÿçš„ç³»ç»Ÿid>",
    "PractitionerIdentifier": "<åŒ»ç”Ÿçš„å·¥å·>",
    "PractitionerName": "<åŒ»ç”Ÿå§“å>",
    "PractitionerConfirmStatus": "åŒ»ç”Ÿæ˜¯å¦ç¡®è®¤é¢„çº¦çš„çŠ¶æ€ åˆå§‹å€¼ needs-action"
}


* é¢„çº¦æ–¹å¼, å–å€¼èŒƒå›´åœ¨å€¼åŸŸ `http://moh.gov/fhir/appointmentmethod` ä¸­:

| ç¼–ç                | æè¿°                 |
|:-------------------|:---------------------|
| hospital-tel       | åŒ»é™¢ç”µè¯é¢„çº¦         |
| hospital-web       | åŒ»é™¢é—¨æˆ·ç½‘ç«™é¢„çº¦     |
| hospital-msg       | åŒ»é™¢çŸ­ä¿¡é¢„çº¦         |
| hospital-his       | åŒ»ç”Ÿå·¥ä½œç«™é¢„çº¦       |
| hospital-bianmin   | ä¾¿æ°‘æœåŠ¡ä¸­å¿ƒé¢„çº¦     |
| hospital-zizhuji   | è‡ªåŠ©æœºé¢„çº¦           |
| hospital-other     | åŒ»é™¢å†…éƒ¨å…¶ä»–æ–¹å¼é¢„çº¦ |
| hospital-yilian    | åŒ»è”é¢„çº¦             |
| hospital-thirdpart | ç¬¬ä¸‰æ–¹é¢„çº¦           |


* é¢„çº¦çŠ¶æ€, å–å€¼èŒƒå›´åœ¨å€¼åŸŸ `http://hl7.org/fhir/appointmentstatus` ä¸­:

| ç¼–ç       | æè¿°                     |
|:----------|:-------------------------|
| pending   | ç­‰å¾…ç¡®è®¤ä¸­               |
| booked    | å·²å®Œæˆé¢„çº¦               |
| arrived   | æ‚£è€…åœ¨é¢„çº¦æ—¥æœŸæ—¶é—´å†…å‡ºç° |
| fulfilled | æ‚£è€…å®Œæˆé¢„çº¦             |
| cancelled | é¢„çº¦è¢«å–æ¶ˆ               |
| noshow    | æ‚£è€…çˆ½çº¦                 |

* é¢„çº¦ç±»å‹, å–å€¼èŒƒå›´åœ¨å€¼åŸŸ `http://moh.gov/fhir/appointmenttype` ä¸­:

| ç¼–ç        | æè¿° |
|:-----------|:-----|
| expert     | ä¸“å®¶ |
| department | ä¸“ç§‘ |
| disease    | ä¸“ç—… |
| special    | ç‰¹éœ€ |
| normal     | æ™®é€š |

* å‚ä¸è€…æ˜¯å¦ç¡®è®¤é¢„çº¦çš„çŠ¶æ€, å–å€¼èŒƒå›´åœ¨å€¼åŸŸ `http://moh.gov/fhir/appointmenttype` ä¸­:

| ç¼–ç          | æè¿°                 |
|:-------------|:---------------------|
| needs-action | éœ€è¦æ‚£è€…ç¡®è®¤æœ¬æ¬¡é¢„çº¦ |
| tentative    | å¾…å®š                 |
| declined     | æ‹’ç»æœ¬æ¬¡é¢„çº¦         |
| accepted     | æ¥å—æœ¬æ¬¡é¢„çº¦         |

```


`GraphQL`è¿˜èƒ½è®©å…¶ä»–ç³»ç»Ÿé«˜æ•ˆåœ°æ‰¹é‡è·å–æ•°æ®ã€‚çœ‹ä¸€çœ‹ä¸‹é¢`GraphQL`è¯·æ±‚çš„ğŸŒ°ï¼š
```js 
$ curl -X POST -H "Authorization: Bearer ACCESS_TOKEN" https://api.hit.com/v1/graphql --data '
{
  appointmentRequest {
    _id,
    type,
    reason,
    status,
    patient {
      id,
      identifier,
      name,
      confirmStatus
    },
    practitioner {
      id,
      identifier,
      name,
      confirmStatus 
    }
  } 
}'
```

è¿™æ¬¡ `GraphQL` æŸ¥è¯¢ç”¨äºè·å–é¢„çº¦æŒ‚å·è¯·æ±‚ä»¥åŠç›¸åº”æ‚£è€… åŒ»ç”Ÿçš„ç›¸å…³ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯è¯·æ±‚è¿”å›ç»“æœï¼š
```js
{
  "data": {
    "appointmentRequest": [
      {
      "_id": "03390abb5570ce03ae524397d215713a",
      "type": "thirdpart ç¬¬ä¸‰æ–¹é¢„çº¦å¹³å°",
      "reason": "ç”²äº¢",      
      "status": "pending ç­‰å¾…ç¡®è®¤ä¸­",
      "patient": {
        "id": "03390abb5570ce03ae524397xxxxxx",
        "identifier": "èº«ä»½è¯ä»¶å·ç ",
        "name": "Peter James1",      
        "confirmStatus": "accepted"
      },      
      "practitioner": {
        "id": "03390abb5570ce03ae5243971xxxxx",
        "identifier": "åŒ»ç”Ÿçš„å·¥å·",
        "name": "Bob1",      
        "confirmStatus": "accepted"
      }
    }ï¼Œ
    {
      "_id": "03390abb5570ce03ae524397d215713b",
      "type": "thirdpart ç¬¬ä¸‰æ–¹é¢„çº¦å¹³å°",
      "reason": "ç”²äº¢",      
      "status": "pending ç­‰å¾…ç¡®è®¤ä¸­",
      "patient": {
        "id": "03390abb5570ce03ae524398xxxxxx",
        "identifier": "èº«ä»½è¯ä»¶å·ç ",
        "name": "Peter James2",      
        "confirmStatus": "accepted"
      },      
      "practitioner": {
        "id": "03390abb5570ce03ae5243972xxxxx",
        "identifier": "åŒ»ç”Ÿçš„å·¥å·",
        "name": "Bob1",      
        "confirmStatus": "pending"
      }
    }
   ]

  }
}
```

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯`FHIR`ï¼Œé‚£ä¹ˆä½ éœ€è¦
```
  GET [base]/Appointment?_list=$current-appointments
```
æˆ–è€…
```
POST  [base]/Appointment/_search?_list=$current-appointments
```

**`GraphQL` æ˜¯ä¸€ç§è§„èŒƒã€‚**

å› æ­¤ï¼Œå®ƒå¯ä»¥åº”ç”¨äºä»»ä½•å¹³å°æˆ–è€…è¯­è¨€ã€‚ å®ƒæœ‰ä¸€ä¸ªç”±`Facebook`ç»´æŠ¤çš„åŸºäº[`JavaScript`](https://github.com/graphql/graphql-js)çš„å‚è€ƒå®ç°ã€‚ è¿˜æœ‰ç”±ç¤¾åŒºç»´æŠ¤çš„å…¶ä»–è¯­è¨€çš„[å®ç°](https://github.com/chentsulin/awesome-graphql#table-of-contents)ã€‚

> è¿™æ˜¯è§„èŒƒæ–‡æ¡£: `<http://facebook.github.io/graphql/>`

ä½ ä¸€æ—¦å·²ç»å°è¯•è¿‡`GraphQL`ï¼Œä½ ä¼šæƒ³è¦å°†ä»–åº”ç”¨åˆ°ä½ çš„æ¯ä¸€ä¸ªé¡¹ç›®ä¸­ã€‚
